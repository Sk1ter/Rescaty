<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rescaty – Mascotas</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
	rel="stylesheet">

<link rel="stylesheet" th:href="@{/css/dashboard.css}">
</head>

<body>

	<div class="dashboard-container">

		<!-- SIDEBAR -->
		<aside class="sidebar shadow">

			<div class="sidebar-header text-center">
				<img src="/img/AvatarUser.png" class="user-avatar" alt="avatar">

				<div class="user-info">
					<h5 class="user-name"
						th:text="${user != null ? user.nombres + ' ' + user.apellido : 'Usuario'}">Usuario</h5>

					<p class="user-email"
						th:text="${user != null ? user.email : 'correo@ejemplo.com'}">correo@ejemplo.com</p>
				</div>
			</div>

			<nav class="sidebar-nav">
				<p class="nav-title">Menú</p>

				<a th:href="@{/dashboard}" class="nav-item"> <i
					class="fa-solid fa-calendar-check nav-icon"></i>Actividades
				</a> <a th:href="@{/mascotas}" class="nav-item active"> <i
					class="fa-solid fa-dog nav-icon"></i>Mascotas
				</a> <a href="#" class="nav-item"> <i
					class="fa-solid fa-heart nav-icon"></i>Adopciones
				</a> <a href="#" class="nav-item"> <i
					class="fa-solid fa-users nav-icon"></i>Usuarios
				</a>
			</nav>

			<div class="sidebar-footer">
				<a href="#" class="nav-item"><i
					class="fa-solid fa-gear nav-icon"></i>Configuración</a> <a href="#"
					class="nav-item logout"><i
					class="fa-solid fa-right-from-bracket nav-icon"></i>Cerrar sesión</a>
			</div>
		</aside>

		<!-- CONTENIDO -->
		<main class="content shadow">

			<!-- HEADER -->
			<div
				class="content-header d-flex justify-content-between align-items-center mb-4">
				<h2 class="fw-bold">Mascotas</h2>

				<button class="btn btn-rescaty" data-bs-toggle="modal"
					data-bs-target="#modalAddPet">
					<i class="fa-solid fa-circle-plus me-2"></i>Añadir Mascota
				</button>
			</div>
			
			<!-- BUSCADOR -->
			<form th:action="@{/mascota/buscar}" method="get" class="mb-4 d-flex"
				style="gap: 10px; max-width: 400px;">
				<input type="number" name="id" class="form-control"
					placeholder="Buscar por ID..." required>
				<button type="submit" class="btn btn-rescaty">Buscar</button>
			</form>
			
			<a href="/dashboard" class="btn btn-secondary btn-sm ms-2 mb-4">Ver todos</a>

			<div th:if="${mensaje != null}" class="alert alert-warning">
				<span th:text="${mensaje}"></span>
			</div>

			<!-- LISTA DE MASCOTAS -->
			<div class="row g-4" th:if="${mascotas != null}">
				<div class="col-12 col-sm-6 col-lg-3" th:each="pet : ${mascotas}">

					<div class="card event-card">

						<img src="/img/pet-default.jpg" alt="Mascota">

						<div class="card-body">

							<h6 th:text="${pet.nombre}">Nombre</h6>

							<a href="#" th:text="${pet.especie + ' · ' + pet.raza}">Perro
								· Golden</a>

							<ul class="event-info">
								<li><i class="fa-solid fa-venus-mars"></i> <span
									th:text="${pet.sexo}">Hembra</span></li>
								<li><i class="fa-solid fa-cake-candles"></i> <span
									th:text="${pet.edadMeses + ' meses'}">12 meses</span></li>
								<li><i class="fa-solid fa-heart-pulse"></i> <span
									th:text="${pet.salud}">Sana</span></li>
							</ul>

							<p class="event-participantes">
								<i class="fa-solid fa-paw"></i> Estado: <span
									th:text="${pet.estado}">Disponible</span>
							</p>

							<div class="card-actions d-flex justify-content-end gap-2">

								<!-- EDITAR -->
								<a th:href="@{'/mascotas/editar/' + ${pet.id}}"
									class="btn-icon btn-edit" title="Editar"> <i
									class="fa-solid fa-pen"></i>
								</a>

								<!-- ELIMINAR -->
								<form th:action="@{'/mascotas/eliminar/' + ${pet.id}}"
									method="post"
									style="display: inline-block; margin: 0; padding: 0;">
									<button type="submit" class="btn-icon btn-delete"
										title="Eliminar">
										<i class="fa-solid fa-trash"></i>
									</button>
								</form>

							</div>
						</div>
					</div>

				</div>
			</div>

		</main>
	</div>

	<!-- MODAL AÑADIR MASCOTA -->
	<div class="modal fade" id="modalAddPet" tabindex="-1">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content">

				<div class="modal-header border-0">
					<h5 class="modal-title fw-bold">Añadir Mascota</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<form th:action="@{/mascotas/crear}" method="post">
					<div class="modal-body">
						<div class="row g-3">

							<div class="col-md-6">
								<label class="form-label">Nombre</label> <input type="text"
									name="nombre" class="form-control" required>
							</div>

							<div class="col-md-6">
								<label class="form-label">Especie</label> <input type="text"
									name="especie" class="form-control" required>
							</div>

							<div class="col-md-6">
								<label class="form-label">Raza</label> <input type="text"
									name="raza" class="form-control">
							</div>

							<div class="col-md-6">
								<label class="form-label">Sexo</label> <input type="text"
									name="sexo" class="form-control">
							</div>

							<div class="col-md-6">
								<label class="form-label">Edad (meses)</label> <input
									type="number" name="edadMeses" class="form-control">
							</div>

							<div class="col-md-6">
								<label class="form-label">Salud</label> <input type="text"
									name="salud" class="form-control">
							</div>

							<div class="col-12">
								<label class="form-label">Estado</label> <input type="text"
									name="estado" class="form-control">
							</div>

						</div>
					</div>

					<div class="modal-footer border-0">
						<button type="button" class="btn btn-cancel"
							data-bs-dismiss="modal">Cancelar</button>
						<button type="submit" class="btn btn-rescaty">
							<i class="fa-solid fa-check me-2"></i>Guardar
						</button>
					</div>
				</form>

			</div>
		</div>
	</div>

	<!-- MODAL EDITAR MASCOTA -->
	<div class="modal fade" id="modalEditarMascota" tabindex="-1">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content modal-rescaty">

				<div class="modal-header">
					<h5 class="modal-title fw-bold">Editar Mascota</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<form th:if="${mascotaEdit != null}"
					th:action="@{'/mascotas/editar/' + ${mascotaEdit.id}}"
					method="post">

					<div class="modal-body">

						<div class="mb-3">
							<label class="form-label">Nombre</label> <input type="text"
								class="form-control" name="nombre"
								th:value="${mascotaEdit.nombre}">
						</div>

						<div class="mb-3">
							<label class="form-label">Especie</label> <input type="text"
								class="form-control" name="especie"
								th:value="${mascotaEdit.especie}">
						</div>

						<div class="mb-3">
							<label class="form-label">Raza</label> <input type="text"
								class="form-control" name="raza" th:value="${mascotaEdit.raza}">
						</div>

						<div class="mb-3">
							<label class="form-label">Sexo</label> <input type="text"
								class="form-control" name="sexo" th:value="${mascotaEdit.sexo}">
						</div>

						<div class="mb-3">
							<label class="form-label">Edad (meses)</label> <input
								type="number" class="form-control" name="edadMeses"
								th:value="${mascotaEdit.edadMeses}">
						</div>

						<div class="mb-3">
							<label class="form-label">Salud</label> <input type="text"
								class="form-control" name="salud"
								th:value="${mascotaEdit.salud}">
						</div>

						<div class="mb-3">
							<label class="form-label">Estado</label> <input type="text"
								class="form-control" name="estado"
								th:value="${mascotaEdit.estado}">
						</div>

					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-cancel"
							data-bs-dismiss="modal">Cancelar</button>
						<button type="submit" class="btn btn-rescaty">Guardar
							Cambios</button>
					</div>

				</form>

			</div>
		</div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

	<!-- AUTOABRIR MODAL EDITAR MASCOTA -->
	<th:block th:if="${abrirModalEditarMascota}">
		<script>
			document.addEventListener('DOMContentLoaded', function() {
				var modal = document.getElementById('modalEditarMascota');
				if (modal) {
					var instance = new bootstrap.Modal(modal);
					instance.show();
				}
			});
		</script>
	</th:block>

</body>
</html>
