<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rescaty – Panel Administrativo</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
	rel="stylesheet">

<link rel="stylesheet" th:href="@{/css/dashboard.css}">
</head>

<body>

	<div class="dashboard-container">

		<!-- SIDEBAR -->
		<aside class="sidebar shadow">

			<div class="sidebar-header text-center">
				<img src="/img/AvatarUser.png" class="user-avatar" alt="avatar">

				<div class="user-info">
					<h5 class="user-name"
						th:text="${user != null ? user.nombres + ' ' + user.apellido : 'Usuario'}">Usuario</h5>

					<p class="user-email"
						th:text="${user != null ? user.email : 'correo@ejemplo.com'}">correo@ejemplo.com</p>
				</div>
			</div>

			<nav class="sidebar-nav">
				<p class="nav-title">Menú</p>

				<a href="#" class="nav-item active"><i
					class="fa-solid fa-calendar-check nav-icon"></i>Actividades</a> <a
					href="#" class="nav-item"><i class="fa-solid fa-dog nav-icon"></i>Mascotas</a>
				<a href="#" class="nav-item"><i
					class="fa-solid fa-heart nav-icon"></i>Adopciones</a> <a href="#"
					class="nav-item"><i class="fa-solid fa-users nav-icon"></i>Usuarios</a>
			</nav>

			<div class="sidebar-footer">
				<a href="#" class="nav-item"><i
					class="fa-solid fa-gear nav-icon"></i>Configuración</a> <a href="#"
					class="nav-item logout"><i
					class="fa-solid fa-right-from-bracket nav-icon"></i>Cerrar sesión</a>
			</div>
		</aside>

		<!-- CONTENIDO -->
		<main class="content shadow">

			<!-- HEADER -->
			<div
				class="content-header d-flex justify-content-between align-items-center mb-4">
				<h2 class="fw-bold">Actividades</h2>

				<button class="btn btn-rescaty" data-bs-toggle="modal"
					data-bs-target="#modalAddEvent">
					<i class="fa-solid fa-circle-plus me-2"></i>Añadir Evento
				</button>
			</div>

			<!-- LISTA DE EVENTOS -->
			<div class="row g-4" th:if="${events != null}">
				<div class="col-12 col-sm-6 col-lg-3" th:each="event : ${events}">

					<div class="card event-card">

						<img src="/img/event-default.jpg" alt="Evento">

						<div class="card-body">

							<h6 th:text="${event.titulo}"></h6>

							<a href="#" th:text="${event.organizador}"></a>

							<ul class="event-info">
								<li><i class="fa-solid fa-calendar"></i> <span
									th:text="${event.fecha}"></span></li>
								<li><i class="fa-solid fa-clock"></i> <span
									th:text="${event.hora}"></span></li>
								<li><i class="fa-solid fa-location-dot"></i> <span
									th:text="${event.ubicacion}"></span></li>
							</ul>

							<p class="event-participantes">
								<i class="fa-solid fa-users"></i> Cupos: <span
									th:text="${event.participantes}"></span>
							</p>

							<div class="card-actions d-flex justify-content-end gap-2">

								<!-- EDITAR -->
								<a th:href="@{'/eventos/editar/' + ${event.id}}"
									class="btn-icon btn-edit" title="Editar"> <i
									class="fa-solid fa-pen"></i>
								</a>

								<!-- ELIMINAR -->
								<form th:action="@{'/eventos/eliminar/' + ${event.id}}"
									method="post"
									style="display: inline-block; margin: 0; padding: 0;">
									<button type="submit" class="btn-icon btn-delete"
										title="Eliminar">
										<i class="fa-solid fa-trash"></i>
									</button>
								</form>

							</div>
						</div>
					</div>
				</div>
			</div>

		</main>
	</div>

	<!-- MODAL AÑADIR -->
	<div class="modal fade" id="modalAddEvent" tabindex="-1">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content">

				<div class="modal-header border-0">
					<h5 class="modal-title fw-bold">Añadir Evento</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<form th:action="@{/eventos/crear}" method="post">
					<div class="modal-body">
						<div class="row g-3">

							<div class="col-md-6">
								<label class="form-label">Título</label> <input type="text"
									name="titulo" class="form-control" required>
							</div>

							<div class="col-md-6">
								<label class="form-label">Organizador</label> <input type="text"
									name="organizador" class="form-control" required>
							</div>

							<div class="col-md-6">
								<label class="form-label">Fecha</label> <input type="date"
									name="fecha" class="form-control" required>
							</div>

							<div class="col-md-6">
								<label class="form-label">Hora</label> <input type="time"
									name="hora" class="form-control" required>
							</div>

							<div class="col-12">
								<label class="form-label">Ubicación</label> <input type="text"
									name="ubicacion" class="form-control" required>
							</div>

							<div class="col-md-6">
								<label class="form-label">Duración</label> <input type="text"
									name="duracion" class="form-control" required>
							</div>

							<div class="col-md-6">
								<label class="form-label">Cupos disponibles</label> <input
									type="number" name="participantes" class="form-control"
									required>
							</div>

						</div>
					</div>

					<div class="modal-footer border-0">
						<button type="button" class="btn btn-cancel"
							data-bs-dismiss="modal">Cancelar</button>
						<button type="submit" class="btn btn-rescaty">
							<i class="fa-solid fa-check me-2"></i>Guardar
						</button>
					</div>
				</form>

			</div>
		</div>
	</div>

	<!-- MODAL EDITAR -->
	<div class="modal fade" id="modalEditarEvento" tabindex="-1">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content modal-rescaty">

				<div class="modal-header">
					<h5 class="modal-title fw-bold">Editar Evento</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<form th:if="${eventoEdit != null}"
					th:action="@{'/eventos/editar/' + ${eventoEdit.id}}" method="post">

					<div class="modal-body">

						<div class="mb-3">
							<label class="form-label">Título</label> <input type="text"
								class="form-control" name="titulo"
								th:value="${eventoEdit.titulo}">
						</div>

						<div class="mb-3">
							<label class="form-label">Organizador</label> <input type="text"
								class="form-control" name="organizador"
								th:value="${eventoEdit.organizador}">
						</div>

						<div class="mb-3">
							<label class="form-label">Fecha</label> <input type="date"
								class="form-control" name="fecha" th:value="${eventoEdit.fecha}">
						</div>

						<div class="mb-3">
							<label class="form-label">Hora</label> <input type="time"
								class="form-control" name="hora" th:value="${eventoEdit.hora}">
						</div>

						<div class="mb-3">
							<label class="form-label">Ubicación</label> <input type="text"
								class="form-control" name="ubicacion"
								th:value="${eventoEdit.ubicacion}">
						</div>

						<div class="mb-3">
							<label class="form-label">Cupos disponibles</label> <input
								type="number" class="form-control" name="participantes"
								th:value="${eventoEdit.participantes}">
						</div>

					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-cancel"
							data-bs-dismiss="modal">Cancelar</button>
						<button type="submit" class="btn btn-rescaty">Guardar
							Cambios</button>
					</div>

				</form>

			</div>
		</div>
	</div>

	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

	<!-- AUTO-ABRIR MODAL EDITAR SOLO CUANDO HAY eventoEdit -->
	<th:block th:if="${abrirModalEditar}">
		<script>
			document.addEventListener('DOMContentLoaded', function() {
				var modalEditar = document.getElementById('modalEditarEvento');
				if (modalEditar) {
					var instance = new bootstrap.Modal(modalEditar);
					instance.show();
				}
			});
		</script>
	</th:block>

</body>
</html>
